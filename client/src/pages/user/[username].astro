---
import { type User } from "@/types/user";
import Icon from "astro-icon";
import ProfileLayout from "@/layouts/profile-layout.astro";
import { formatDate } from "@/lib/utils/format";

const { username } = Astro.params;

const cookie = Astro.cookies.get("auth_token");
const BASE_URL = import.meta.env.PUBLIC_API;

if (!cookie) {
  Astro.redirect("/login");
}

// const user: User = await fetch(`${BASE_URL}/users/username/${username}`, {
//   method: "GET",
//   headers: {
//     Cookie: `auth_token=${cookie?.value}`,
//   },
// })
//   .then(async (response) => await response.json())
//   .then((data) => data.data)
//   .catch((error) => {
//     console.error(error);
//     return {};
//   });

const user: User = await fetch(`${BASE_URL}/users/current`, {
  method: "GET",
  headers: {
    Cookie: `auth_token=${cookie?.value}`,
  },
})
  .then(async (response) => await response.json())
  .then((data) => data.data)
  .catch((error) => {
    console.error(error);
    return {};
  });

console.log({ currentUser: user });
---

<ProfileLayout title="User Profile">
  <div class="w-full h-80">
    <img src="/banner.png" alt="User avatar" class="w-full h-full" />
  </div>
  <div class="flex flex-col items-center">
    <div class="w-36 h-36 rounded-full overflow-hidden -mt-20">
      <img
        src="https://res.cloudinary.com/dafwzsod0/image/upload/v1687431921/user-avatar-4_zdqcbw.svg"
        alt="User avatar"
        class="w-full h-full"
      />
    </div>
    <div class="flex flex-col items-center gap-2 mt-4">
      <h2 class="text-2xl font-bold">{user?.name}</h2>
      <p class="text-slate-700 max-w-xl text-center">{user?.bio}</p>
      <span class="text-slate-500"
        >@{user.username} &bull; Joined {formatDate(user.created_at)}</span
      >
    </div>
  </div>
  <div class="w-full h-[2px] bg-slate-300 my-10"></div>
  <div class="mx-36 grid grid-cols-[200px,1fr] gap-8">
    <div class="border">Resume</div>
    <div class="border flex-1">About</div>
  </div>
</ProfileLayout>
